<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dagger-App — Delivering (Immersive Mockup)</title>

  <!--
    ==========================================================================
    STAGE 6: DELIVERING — Your tale awaits.
    ==========================================================================
    Panel pattern: CELEBRATION + DOWNLOAD
    The Sage delivers the completed tale. The user sees what they created
    and downloads the adventure to bring to life at the table.

    Panel shows a narrative journey: the adventure title, the original spark,
    the frame overview, the inciting incident, and a celebratory send-off.
    A single "Bring This Tale to Life" button downloads a zip (Markdown + PDF)
    and silently saves the adventure to the user's account.

    DESIGN RATIONALE: This is a celebration, not a review. The panel tells
    the story of what was created — from spark to finished tale. No checklists,
    no stat boxes, no format selectors. The user should feel "look at what we
    did together," not "the ride is over." The download button is the only
    interactive element — one action, one moment.
    ==========================================================================
  -->

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Source+Serif+4:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">

  <style>
    /* =======================================================================
       DESIGN TOKENS — Shared across all mockups
       ======================================================================= */
    :root {
      --bg-primary: #1c1b1f;
      --bg-secondary: #252428;
      --bg-surface: #2e2d32;
      --bg-surface-hover: #353439;
      --text-primary: #e8e4de;
      --text-secondary: #9d9a93;
      --text-muted: #6b6862;
      --accent-gold: #d7a964;
      --accent-gold-hover: #e5bc7a;
      --accent-gold-dim: rgba(215, 169, 100, 0.12);
      --accent-gold-border: rgba(215, 169, 100, 0.25);
      --accent-gold-glow: rgba(215, 169, 100, 0.15);
      --border-subtle: rgba(255, 255, 255, 0.06);
      --border-medium: rgba(255, 255, 255, 0.10);
      --border-hover: rgba(255, 255, 255, 0.14);
      --user-msg-bg: rgba(255, 255, 255, 0.07);
      --font-serif: 'Source Serif 4', Georgia, 'Times New Roman', serif;
      --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
      --message-gap: 28px;
      --section-padding: 24px;
      --panel-padding: 20px;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
    }

    /* === RESET & BASE === */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%; overflow: hidden;
      background: var(--bg-primary); color: var(--text-primary);
      font-family: var(--font-sans); font-size: 15px; line-height: 1.6;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }

    /* === LAYOUT === */
    .app-shell { display: flex; flex-direction: column; height: 100vh; width: 100%; }
    .app-header {
      flex-shrink: 0; display: flex; align-items: center;
      padding: 0 16px; height: 56px;
      background: var(--bg-secondary); border-bottom: 1px solid var(--border-subtle);
    }
    .app-header-home {
      display: flex; align-items: center; justify-content: center;
      width: 32px; height: 32px; border-radius: var(--radius-sm);
      background: none; border: none; color: var(--text-muted);
      cursor: pointer; transition: color 0.15s ease, background 0.15s ease; flex-shrink: 0;
    }
    .app-header-home:hover { color: var(--text-secondary); background: var(--bg-surface); }
    .app-header-title {
      font-family: var(--font-serif); font-size: 16px; font-weight: 500;
      color: var(--accent-gold); white-space: nowrap; overflow: hidden;
      text-overflow: ellipsis; min-width: 0; flex: 1; text-align: center;
    }
    .app-layout { display: grid; grid-template-columns: 13fr 7fr; flex: 1; min-height: 0; width: 100%; }

    /* === CHAT SIDE === */
    .chat-side { display: flex; flex-direction: column; min-height: 0; border-right: 1px solid var(--border-subtle); }
    .message-area {
      flex: 1; overflow-y: auto; padding: 36px var(--section-padding) 8px;
      scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.08) transparent;
    }
    .message-area::-webkit-scrollbar { width: 6px; }
    .message-area::-webkit-scrollbar-track { background: transparent; }
    .message-area::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }
    .messages { max-width: 720px; margin: 0 auto; display: flex; flex-direction: column; gap: var(--message-gap); }
    .message { max-width: 88%; animation: message-appear 0.4s ease-out both; }
    @keyframes message-appear {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .message-sage { align-self: flex-start; }
    .message-sage .message-text { font-family: var(--font-serif); font-size: 16px; }
    .message-user {
      align-self: flex-end; background: var(--user-msg-bg);
      border: 1px solid var(--border-subtle); padding: 12px 16px; border-radius: var(--radius-md);
    }
    .sage-label {
      font-family: var(--font-serif); font-size: 12px; font-weight: 500;
      color: var(--text-muted); letter-spacing: 0.03em; margin-bottom: 6px;
    }
    .message-text { color: var(--text-primary); line-height: 1.65; }
    .message-text p + p { margin-top: 12px; }
    .message:nth-child(1) { animation-delay: 0s; }
    .message:nth-child(2) { animation-delay: 0.06s; }
    .message:nth-child(3) { animation-delay: 0.12s; }
    .message:nth-child(4) { animation-delay: 0.18s; }
    .message:nth-child(5) { animation-delay: 0.24s; }

    /* === INPUT === */
    .input-area { flex-shrink: 0; padding: 12px var(--section-padding) var(--section-padding); }
    .input-container { position: relative; max-width: 720px; margin: 0 auto; }
    .chat-input {
      width: 100%; min-height: 88px; max-height: 180px;
      padding: 14px 52px 14px 18px; background: var(--bg-secondary);
      border: 1px solid var(--border-subtle); border-radius: var(--radius-lg);
      color: var(--text-primary); font-family: var(--font-sans);
      font-size: 15px; line-height: 1.55; resize: none; outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .chat-input::placeholder { color: var(--text-muted); font-style: italic; }
    .chat-input:focus { border-color: var(--accent-gold-border); box-shadow: 0 0 0 3px var(--accent-gold-glow); }
    .submit-btn {
      position: absolute; bottom: 12px; right: 12px; width: 36px; height: 36px;
      border-radius: 50%; border: none; background: var(--accent-gold);
      color: var(--bg-primary); cursor: pointer; display: flex; align-items: center;
      justify-content: center; transition: background 0.15s ease, transform 0.15s ease; opacity: 0.7;
    }
    .submit-btn:hover { background: var(--accent-gold-hover); opacity: 1; transform: scale(1.05); }
    .submit-btn svg { width: 20px; height: 20px; }

    /* === PANEL SIDE === */
    .panel-side {
      display: flex; flex-direction: column; min-height: 0; background: var(--bg-secondary);
    }
    .panel-header {
      flex-shrink: 0; padding: 12px var(--panel-padding) 4px;
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
    }

    /* Phase dropdown trigger + dropdown */
    .app-header-phase {
      position: relative; display: flex; align-items: center; gap: 8px;
      cursor: pointer; padding: 4px 10px 4px 4px; border-radius: var(--radius-sm);
      border: none; background: none; transition: background 0.15s ease; flex-shrink: 0;
    }
    .app-header-phase:hover { background: var(--bg-surface); }
    .phase-name { font-family: var(--font-sans); font-size: 13px; font-weight: 500; color: var(--accent-gold); }
    .phase-progress { font-family: var(--font-sans); font-size: 12px; color: var(--text-muted); }
    .phase-chevron { color: var(--text-muted); font-size: 10px; transition: transform 0.2s ease; margin-left: -2px; }
    .phase-chevron.open { transform: rotate(180deg); }
    .phase-dropdown {
      position: absolute; top: calc(100% + 6px); left: 50%; transform: translateX(-50%);
      min-width: 260px; background: var(--bg-surface); border: 1px solid var(--border-medium);
      border-radius: var(--radius-md); box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      padding: 6px; z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.15s ease;
    }
    .phase-dropdown.open { opacity: 1; pointer-events: auto; }
    .phase-dropdown-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 12px; border-radius: var(--radius-sm); font-family: var(--font-sans);
      font-size: 13px; color: var(--text-secondary); cursor: pointer;
      transition: background 0.12s ease; border: none; background: none; width: 100%; text-align: left;
    }
    .phase-dropdown-item:hover { background: var(--bg-surface-hover); }
    .phase-dropdown-item.current { color: var(--accent-gold); font-weight: 600; background: var(--accent-gold-dim); }
    .phase-dropdown-item.completed { color: var(--text-secondary); }
    .phase-dropdown-item.future { color: var(--text-muted); cursor: default; opacity: 0.6; }
    .phase-dropdown-item.future:hover { background: none; }
    .phase-item-icon { display: flex; align-items: center; flex-shrink: 0; margin-left: auto; padding-left: 12px; }
    .phase-item-icon svg { width: 12px; height: 12px; }
    .phase-item-text { display: flex; flex-direction: column; gap: 1px; min-width: 0; }
    .phase-item-desc { font-size: 11px; font-weight: 400; color: var(--text-muted); }
    .phase-dropdown-item.current .phase-item-desc { color: var(--accent-gold); opacity: 0.7; }

    /* === DELIVERING PANEL — Celebration + Download ===
       DESIGN RATIONALE: The Delivering panel is a celebration. It tells
       the story of what was created — from spark to finished tale. No checklists,
       no stat boxes, no format selectors. The user should feel "look at what we
       did together." The content flows narratively: spark → frame → inciting
       incident → send-off → download.
    */
    .panel-content {
      flex: 1; overflow-y: auto; padding: 8px var(--panel-padding) var(--panel-padding);
      scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.06) transparent;
    }
    .panel-content::-webkit-scrollbar { width: 5px; }
    .panel-content::-webkit-scrollbar-track { background: transparent; }
    .panel-content::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 3px; }

    /* Adventure title */
    .adventure-title {
      font-family: var(--font-serif);
      font-size: 22px;
      font-weight: 600;
      color: var(--accent-gold);
      text-align: center;
      padding: 16px 0 8px;
      line-height: 1.3;
    }

    /* Section labels */
    .section-label {
      font-family: var(--font-serif);
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 8px;
    }

    /* Spark card — callback to Invoking */
    .spark-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-left: 3px solid var(--accent-gold-border);
      border-radius: var(--radius-sm);
      padding: 14px 16px;
      margin-bottom: 20px;
    }
    .spark-text {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.65;
    }

    /* Frame overview */
    .frame-card {
      background: var(--bg-surface);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 20px;
    }
    .frame-name {
      font-family: var(--font-serif);
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    .frame-overview {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.65;
    }

    /* Inciting incident */
    .incident-card {
      background: var(--bg-surface);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 24px;
    }
    .incident-text {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.65;
    }

    /* Narrative send-off */
    .sendoff {
      text-align: center;
      padding: 16px 8px 24px;
      margin-bottom: 16px;
    }
    .sendoff-text {
      font-family: var(--font-serif);
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.7;
      font-style: italic;
    }

    /* Divider */
    .divider {
      height: 1px;
      background: var(--border-subtle);
      margin: 4px 0 16px;
    }

    /* Fixed footer — matches Attuning/Binding/Inscribing pattern */
    .panel-footer {
      flex-shrink: 0;
      padding: 12px var(--panel-padding) 32px;
      border-top: 1px solid var(--border-subtle);
    }
    .footer-helper {
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    .btn-continue-compact {
      display: block; width: 100%;
      padding: 7px 16px; border: none; border-radius: var(--radius-sm);
      background: var(--accent-gold); color: var(--bg-primary);
      font-family: var(--font-sans); font-size: 13px; font-weight: 600;
      cursor: pointer; transition: background 0.15s ease, box-shadow 0.2s ease;
      letter-spacing: 0.01em; white-space: nowrap;
    }
    .btn-continue-compact:hover { background: var(--accent-gold-hover); box-shadow: 0 0 16px var(--accent-gold-glow); }

    .streaming-cursor::after {
      content: '\25CB'; color: var(--accent-gold);
      animation: cursor-blink 1s step-end infinite; margin-left: 1px; font-size: 12px;
    }
    @keyframes cursor-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
    }
  </style>
</head>
<body>

  <div class="app-shell">

    <header class="app-header">
      <button class="app-header-home" aria-label="Return to home">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
      </button>
      <span class="app-header-title">Calamity in the Witherwild</span>
    </header>

    <div class="app-layout">

    <!-- ================================================================
         CHAT SIDE (60%)
         ================================================================ -->
    <div class="chat-side">
      <div class="message-area">
        <div class="messages">

          <!-- Sage: Opening — adventure delivered -->
          <div class="message message-sage">
            <div class="sage-label">Sage</div>
            <div class="message-text">
              <p><em>Calamity in the Witherwild</em> is complete.</p>
              <p>From a single spark — a forest that fights back — we've built a world. Four scenes tracing the party from Thornwall Crossing to the heart of the Reaping Eye's domain. Five NPCs whose loyalties will pull your players in different directions. Adversaries scaled for Tier 2, with the Blightmother waiting at the end.</p>
              <p>Take a look at the panel. Everything we created together is there — from where it all began to where it's going next. When you're ready, it's yours to take to the table.</p>
            </div>
          </div>

          <!-- User: Feels great -->
          <div class="message message-user">
            <div class="message-text">
              This is incredible. I can't wait to run this. Any last advice for the table?
            </div>
          </div>

          <!-- Sage: Table advice -->
          <div class="message message-sage">
            <div class="sage-label">Sage</div>
            <div class="message-text">
              <p>Lean into the moral ambiguity. The Wicklings aren't villains and the Havenites aren't heroes — let your players sit in that discomfort. If they try to find a clean answer, the Witherwild itself will remind them that nature doesn't negotiate.</p>
              <p>And don't be afraid to let the echoes breathe. If a player does something unexpected in Scene 2 that changes the Blightmother encounter — that's not a problem, that's the adventure working as intended.</p>
            </div>
          </div>

          <!-- User: Ready to go -->
          <div class="message message-user">
            <div class="message-text">
              Perfect. Let's do this.
            </div>
          </div>

          <!-- Sage: Final words -->
          <div class="message message-sage">
            <div class="sage-label">Sage</div>
            <div class="message-text">
              <p>Go bring this tale to life. May the rolls be ever in your favor.</p>
            </div>
          </div>

        </div>
      </div>

      <div class="input-area">
        <div class="input-container">
          <textarea class="chat-input" placeholder="Say something to the Sage..." rows="3"></textarea>
          <button class="submit-btn" aria-label="Send message">
            <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">
              <polygon points="12,2 16,12 12,22 8,12"></polygon>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- ================================================================
         PANEL SIDE (40%) — Celebration + Download
         ================================================================ -->
    <div class="panel-side">

      <div class="panel-header">
        <div class="app-header-phase" onclick="togglePhaseDropdown()" role="button" tabindex="0" aria-expanded="false" aria-haspopup="true">
          <span class="phase-name">Delivering</span>
          <span class="phase-progress">Your tale awaits</span>
          <span class="phase-chevron" id="phase-chevron">&#9662;</span>

          <div class="phase-dropdown" id="phase-dropdown" role="menu">
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Invoking</span><span class="phase-item-desc">What shape will your adventure take?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--accent-gold);"><polyline points="20 6 9 17 4 12"></polyline></svg></span>
            </div>
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Attuning</span><span class="phase-item-desc">How should it feel?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--accent-gold);"><polyline points="20 6 9 17 4 12"></polyline></svg></span>
            </div>
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Binding</span><span class="phase-item-desc">Which frame holds the story?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--accent-gold);"><polyline points="20 6 9 17 4 12"></polyline></svg></span>
            </div>
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Weaving</span><span class="phase-item-desc">How does the plot unfold?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--accent-gold);"><polyline points="20 6 9 17 4 12"></polyline></svg></span>
            </div>
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Inscribing</span><span class="phase-item-desc">What unfolds in each scene?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="color: var(--accent-gold);"><polyline points="20 6 9 17 4 12"></polyline></svg></span>
            </div>
            <div class="phase-dropdown-item current" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Delivering</span><span class="phase-item-desc">Your tale awaits</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Panel Content — scrollable -->
      <div class="panel-content">

        <!-- Adventure Title -->
        <div class="adventure-title">Calamity in the Witherwild</div>

        <div class="divider"></div>

        <!-- Spark — callback to Invoking -->
        <div class="section-label">Your Spark</div>
        <div class="spark-card">
          <div class="spark-text">"A forest that fights back — something ancient has woken up, and the party is caught between the people trying to survive and the land that wants them gone."</div>
        </div>

        <!-- Frame Overview -->
        <div class="section-label">The Frame</div>
        <div class="frame-card">
          <div class="frame-overview">The nation of Haven, ravaged by plague, invaded the forest realm of Fanewick and stole the Reaping Eye from Nikta, the Great Owl. This triggered an endless spring — unchecked growth devouring everything in its path. Three factions now clash: the <strong>Wicklings</strong>, hardy forest folk following ancient rules; the <strong>Havenites</strong>, desperate survivors driven to invasion by plague; and <strong>the Witherwild itself</strong> — nature run amok, neither good nor evil, just relentless.</div>
        </div>

        <!-- Inciting Incident -->
        <div class="section-label">The Inciting Incident</div>
        <div class="incident-card">
          <div class="incident-text">A Wickling elder sends a desperate plea — the overgrowth has breached the village walls, and something ancient stirs in the deep forest. The party is the last group willing to answer.</div>
        </div>

        <!-- Narrative Send-off -->
        <div class="sendoff">
          <div class="sendoff-text">Your adventure has been delivered. It is now in your hands — take this tale from the pages of the Sage Codex and bring it to life at your table. The story doesn't truly begin until your players sit down and make it their own.</div>
        </div>

      </div>

      <!-- Fixed footer — matches other stage panels -->
      <div class="panel-footer">
        <div class="footer-helper">Downloads Markdown + PDF as a zip file. Also saved to your account.</div>
        <button class="btn-continue-compact">Bring This Tale to Life</button>
      </div>

    </div>

    </div><!-- /app-layout -->
  </div><!-- /app-shell -->

  <script>
    function togglePhaseDropdown() {
      const dropdown = document.getElementById('phase-dropdown');
      const chevron = document.getElementById('phase-chevron');
      const trigger = document.querySelector('.app-header-phase');
      const isOpen = dropdown.classList.contains('open');
      if (isOpen) {
        dropdown.classList.remove('open'); chevron.classList.remove('open');
        trigger.setAttribute('aria-expanded', 'false');
      } else {
        dropdown.classList.add('open'); chevron.classList.add('open');
        trigger.setAttribute('aria-expanded', 'true');
      }
    }

    document.addEventListener('click', function(e) {
      const trigger = document.querySelector('.app-header-phase');
      const dropdown = document.getElementById('phase-dropdown');
      if (!trigger.contains(e.target)) {
        dropdown.classList.remove('open');
        document.getElementById('phase-chevron').classList.remove('open');
        trigger.setAttribute('aria-expanded', 'false');
      }
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        const dropdown = document.getElementById('phase-dropdown');
        if (dropdown.classList.contains('open')) {
          dropdown.classList.remove('open');
          document.getElementById('phase-chevron').classList.remove('open');
          document.querySelector('.app-header-phase').setAttribute('aria-expanded', 'false');
        }
      }
    });

    const textarea = document.querySelector('.chat-input');
    textarea.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 180) + 'px';
    });

    document.querySelector('.message-area').scrollTop = document.querySelector('.message-area').scrollHeight;
  </script>

</body>
</html>
