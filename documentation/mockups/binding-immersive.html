<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dagger-App — Binding (Immersive Mockup)</title>

  <!--
    ==========================================================================
    STAGE 3: BINDING — Which frame holds the story?
    ==========================================================================
    Panel pattern: FRAME GALLERY → FRAME DETAIL PANEL
    The user selects a thematic framework (frame) that anchors the story,
    explores its full detail, then confirms via a fixed "Select Frame" button.
    Frames come from the unified daggerheart_frames table. Each frame includes
    an inciting incident that seeds the adventure.

    Step 1: Frame Gallery — scrollable frame cards with name + pitch only.
    Step 2: Detail Panel — cross-fades in when a frame is clicked.
      Collapsible detail sections (overview and inciting incident expanded
      by default; all others collapsed). Expanded section titles are gold.
      Hovering on label pills turns them gold.
      Fixed "Select Frame" button at the bottom — always visible, never
      scrolls away.

    Three frame card states:
      Default   — subtle border, no highlight (name + pitch)
      Exploring — white/light border (clicked, viewing detail panel)
      Active    — gold treatment (frame confirmed via "Select Frame" button)

    Interaction: Two exit paths from the detail panel:
      "Back to Frames" link — returns to gallery with NO frame active
      "Select Frame" button — returns to gallery with frame marked Active

    DESIGN RATIONALE: Frames are rich multi-section documents (~11 fields),
    not thin cards. The gallery shows only name + pitch for scan-ability.
    All depth lives in the detail panel. One transition, two clear exit
    actions, no ambiguity about confirmation.
    ==========================================================================
  -->

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Source+Serif+4:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">

  <style>
    /* =======================================================================
       DESIGN TOKENS — Shared across all mockups
       ======================================================================= */
    :root {
      --bg-primary: #1c1b1f;
      --bg-secondary: #252428;
      --bg-surface: #2e2d32;
      --bg-surface-hover: #353439;
      --text-primary: #e8e4de;
      --text-secondary: #9d9a93;
      --text-muted: #6b6862;
      --accent-gold: #d7a964;
      --accent-gold-hover: #e5bc7a;
      --accent-gold-dim: rgba(215, 169, 100, 0.12);
      --accent-gold-border: rgba(215, 169, 100, 0.25);
      --accent-gold-glow: rgba(215, 169, 100, 0.15);
      --border-subtle: rgba(255, 255, 255, 0.06);
      --border-medium: rgba(255, 255, 255, 0.10);
      --border-hover: rgba(255, 255, 255, 0.14);
      --user-msg-bg: rgba(255, 255, 255, 0.07);
      --font-serif: 'Source Serif 4', Georgia, 'Times New Roman', serif;
      --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
      --message-gap: 28px;
      --section-padding: 24px;
      --panel-padding: 20px;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
    }

    /* === RESET & BASE === */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%; overflow: hidden;
      background: var(--bg-primary); color: var(--text-primary);
      font-family: var(--font-sans); font-size: 15px; line-height: 1.6;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }

    /* === LAYOUT === */
    .app-shell { display: flex; flex-direction: column; height: 100vh; width: 100%; }
    .app-header {
      flex-shrink: 0; display: flex; align-items: center;
      padding: 0 16px; height: 56px;
      background: var(--bg-secondary); border-bottom: 1px solid var(--border-subtle);
    }
    .app-header-home {
      display: flex; align-items: center; justify-content: center;
      width: 32px; height: 32px; border-radius: var(--radius-sm);
      background: none; border: none; color: var(--text-muted);
      cursor: pointer; transition: color 0.15s ease, background 0.15s ease; flex-shrink: 0;
    }
    .app-header-home:hover { color: var(--text-secondary); background: var(--bg-surface); }
    .app-header-title {
      font-family: var(--font-serif); font-size: 16px; font-weight: 500;
      color: var(--accent-gold); white-space: nowrap; overflow: hidden;
      text-overflow: ellipsis; min-width: 0; flex: 1; text-align: center;
    }
    .app-layout { display: grid; grid-template-columns: 13fr 7fr; flex: 1; min-height: 0; width: 100%; }

    /* === CHAT SIDE === */
    .chat-side { display: flex; flex-direction: column; min-height: 0; border-right: 1px solid var(--border-subtle); }
    .message-area {
      flex: 1; overflow-y: auto; padding: 36px var(--section-padding) 8px;
      scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.08) transparent;
    }
    .message-area::-webkit-scrollbar { width: 6px; }
    .message-area::-webkit-scrollbar-track { background: transparent; }
    .message-area::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }
    .messages { max-width: 720px; margin: 0 auto; display: flex; flex-direction: column; gap: var(--message-gap); }
    .message { max-width: 88%; animation: message-appear 0.4s ease-out both; }
    @keyframes message-appear {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .message-sage { align-self: flex-start; }
    .message-sage .message-text { font-family: var(--font-serif); font-size: 16px; }
    .message-user {
      align-self: flex-end; background: var(--user-msg-bg);
      border: 1px solid var(--border-subtle); padding: 12px 16px; border-radius: var(--radius-md);
    }
    .sage-label {
      font-family: var(--font-serif); font-size: 12px; font-weight: 500;
      color: var(--text-muted); letter-spacing: 0.03em; margin-bottom: 6px;
    }
    .message-text { color: var(--text-primary); line-height: 1.65; }
    .message-text p + p { margin-top: 12px; }
    .message:nth-child(1) { animation-delay: 0s; }
    .message:nth-child(2) { animation-delay: 0.06s; }
    .message:nth-child(3) { animation-delay: 0.12s; }
    .message:nth-child(4) { animation-delay: 0.18s; }
    .message:nth-child(5) { animation-delay: 0.24s; }
    .message:nth-child(6) { animation-delay: 0.30s; }
    .thinking-indicator { display: flex; align-items: center; gap: 5px; padding: 4px 0; align-self: flex-start; }
    .thinking-indicator .sage-label { margin-bottom: 0; margin-right: 4px; }
    .thinking-dot {
      width: 5px; height: 5px; border-radius: 50%;
      background: var(--accent-gold); opacity: 0.3;
      animation: thinking-pulse 1.4s ease-in-out infinite;
    }
    .thinking-dot:nth-child(2) { animation-delay: 0.2s; }
    .thinking-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes thinking-pulse {
      0%, 80%, 100% { opacity: 0.2; transform: scale(0.85); }
      40% { opacity: 0.9; transform: scale(1); }
    }

    /* === INPUT === */
    .input-area { flex-shrink: 0; padding: 12px var(--section-padding) var(--section-padding); }
    .input-container { position: relative; max-width: 720px; margin: 0 auto; }
    .chat-input {
      width: 100%; min-height: 88px; max-height: 180px;
      padding: 14px 52px 14px 18px; background: var(--bg-secondary);
      border: 1px solid var(--border-subtle); border-radius: var(--radius-lg);
      color: var(--text-primary); font-family: var(--font-sans);
      font-size: 15px; line-height: 1.55; resize: none; outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .chat-input::placeholder { color: var(--text-muted); font-style: italic; }
    .chat-input:focus { border-color: var(--accent-gold-border); box-shadow: 0 0 0 3px var(--accent-gold-glow); }
    .submit-btn {
      position: absolute; bottom: 12px; right: 12px; width: 36px; height: 36px;
      border-radius: 50%; border: none; background: var(--accent-gold);
      color: var(--bg-primary); cursor: pointer; display: flex; align-items: center;
      justify-content: center; transition: background 0.15s ease, transform 0.15s ease; opacity: 0.7;
    }
    .submit-btn:hover { background: var(--accent-gold-hover); opacity: 1; transform: scale(1.05); }
    .submit-btn svg { width: 20px; height: 20px; }

    /* === PANEL SIDE === */
    .panel-side {
      display: flex; flex-direction: column; min-height: 0; background: var(--bg-secondary);
    }
    .panel-header {
      flex-shrink: 0; padding: 12px var(--panel-padding) 4px;
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
    }

    /* Phase dropdown trigger + dropdown */
    .app-header-phase {
      position: relative; display: flex; align-items: center; gap: 8px;
      cursor: pointer; padding: 4px 10px 4px 4px; border-radius: var(--radius-sm);
      border: none; background: none; transition: background 0.15s ease; flex-shrink: 0;
    }
    .app-header-phase:hover { background: var(--bg-surface); }
    .phase-name { font-family: var(--font-sans); font-size: 13px; font-weight: 500; color: var(--accent-gold); }
    .phase-progress { font-family: var(--font-sans); font-size: 12px; color: var(--text-muted); }
    .phase-chevron { color: var(--text-muted); font-size: 10px; transition: transform 0.2s ease; margin-left: -2px; }
    .phase-chevron.open { transform: rotate(180deg); }
    .phase-dropdown {
      position: absolute; top: calc(100% + 6px); left: 50%; transform: translateX(-50%);
      min-width: 260px; background: var(--bg-surface); border: 1px solid var(--border-medium);
      border-radius: var(--radius-md); box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      padding: 6px; z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.15s ease;
    }
    .phase-dropdown.open { opacity: 1; pointer-events: auto; }
    .phase-dropdown-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 12px; border-radius: var(--radius-sm); font-family: var(--font-sans);
      font-size: 13px; color: var(--text-secondary); cursor: pointer;
      transition: background 0.12s ease; border: none; background: none; width: 100%; text-align: left;
    }
    .phase-dropdown-item:hover { background: var(--bg-surface-hover); }
    .phase-dropdown-item.current { color: var(--accent-gold); font-weight: 600; background: var(--accent-gold-dim); }
    .phase-dropdown-item.completed { color: var(--text-secondary); }
    .phase-dropdown-item.future { color: var(--text-muted); cursor: default; opacity: 0.6; }
    .phase-dropdown-item.future:hover { background: none; }
    .phase-item-icon { display: flex; align-items: center; flex-shrink: 0; margin-left: auto; padding-left: 12px; }
    .phase-item-icon svg { width: 12px; height: 12px; }
    .phase-item-text { display: flex; flex-direction: column; gap: 1px; min-width: 0; }
    .phase-item-desc { font-size: 11px; font-weight: 400; color: var(--text-muted); }
    .phase-dropdown-item.current .phase-item-desc { color: var(--accent-gold); opacity: 0.7; }

    /* === FRAME GALLERY (Binding-specific) ===
       Three states:
         Default   — subtle border, clickable
         Exploring — white/light border, detail panel is showing
         Active    — gold treatment, frame confirmed
    */
    .frame-list {
      flex: 1; display: flex; flex-direction: column; min-height: 0;
      transition: opacity 0.15s ease;
    }
    .frame-list.hidden { display: none; }

    .frame-scroll {
      flex: 1; overflow-y: auto; padding: 8px var(--panel-padding);
      scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.06) transparent;
    }
    .frame-scroll::-webkit-scrollbar { width: 5px; }
    .frame-scroll::-webkit-scrollbar-track { background: transparent; }
    .frame-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 3px; }

    .gallery-footer {
      flex-shrink: 0;
      padding: 12px var(--panel-padding) 32px;
      border-top: 1px solid var(--border-subtle);
    }

    .frame-card {
      padding: 16px;
      border: 1px solid var(--border-medium);
      border-left: 3px solid transparent;
      border-radius: var(--radius-sm);
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .frame-card:hover {
      background: var(--bg-surface);
      border-color: var(--border-hover);
      border-left-color: var(--border-hover);
    }
    /* Exploring state — white/light border, no gold, no background fill */
    .frame-card.exploring {
      border-color: var(--border-hover);
      border-left-color: var(--border-hover);
    }
    /* Active state — full gold treatment (frame confirmed) */
    .frame-card.active {
      background: var(--accent-gold-dim);
      border-color: var(--accent-gold-border);
      border-left-color: var(--accent-gold);
    }
    .frame-card-name {
      font-family: var(--font-serif);
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }
    .frame-card.active .frame-card-name {
      color: var(--accent-gold-hover);
    }
    .frame-card-pitch {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-top: 4px;
    }

    /* === FRAME DETAIL PANEL ===
       Shown when a frame is clicked. Cross-fades in/out like Attuning's
       choice panels. Contains collapsible frame detail sections and a
       fixed "Select Frame" button at the bottom.
    */
    .detail-panel {
      display: none;
      flex-direction: column; min-height: 0;
      padding: 0 var(--panel-padding);
    }
    .detail-panel.visible {
      display: flex; flex: 1;
    }

    .detail-panel-header {
      flex-shrink: 0;
      padding: 8px 0 4px;
    }
    .detail-frame-name {
      font-family: var(--font-serif);
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-top: 8px;
    }
    .detail-frame-pitch {
      font-family: var(--font-serif);
      font-size: 13px;
      font-style: italic;
      color: var(--text-secondary);
      margin-top: 4px;
      line-height: 1.5;
    }

    /* Scrollable content: detail sections */
    .detail-content {
      flex: 1; overflow-y: auto;
      padding-bottom: 8px;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,0.06) transparent;
    }
    .detail-content::-webkit-scrollbar { width: 5px; }
    .detail-content::-webkit-scrollbar-track { background: transparent; }
    .detail-content::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 3px; }

    /* Fixed footer — always visible at bottom of detail panel */
    .detail-panel-footer {
      flex-shrink: 0;
      padding: 12px 0 32px;
      border-top: 1px solid var(--border-subtle);
    }
    .btn-select-frame {
      display: block;
      width: 100%;
      padding: 7px 16px;
      border: none;
      border-radius: var(--radius-sm);
      background: var(--accent-gold);
      color: var(--bg-primary);
      font-family: var(--font-sans);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s ease, box-shadow 0.2s ease;
      letter-spacing: 0.01em;
    }
    .btn-select-frame:hover {
      background: var(--accent-gold-hover);
      box-shadow: 0 0 16px var(--accent-gold-glow);
    }

    /* --- Collapsible Detail Sections --- */
    .detail-section {
      border-bottom: 1px solid var(--border-subtle);
    }
    .detail-section:last-of-type {
      border-bottom: none;
    }
    .detail-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 0;
      cursor: pointer;
      transition: color 0.15s ease;
      user-select: none;
    }
    .detail-section-header:hover {
      color: var(--accent-gold);
    }
    .detail-section-header:hover .detail-section-label {
      color: var(--accent-gold);
    }
    .detail-section-chevron {
      font-size: 10px;
      color: var(--text-muted);
      transition: transform 0.2s ease;
      flex-shrink: 0;
      width: 14px;
      text-align: center;
    }
    .detail-section.expanded .detail-section-chevron {
      transform: rotate(90deg);
    }
    .detail-section-label {
      font-family: var(--font-serif);
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      transition: color 0.15s ease;
    }
    .detail-section.expanded .detail-section-label {
      color: var(--accent-gold);
    }
    .detail-section-body {
      display: none;
      padding: 0 0 12px 22px;
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.6;
    }
    .detail-section.expanded .detail-section-body {
      display: block;
    }

    /* Pill rows inside detail sections */
    .detail-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .detail-pill {
      font-size: 11px;
      font-weight: 500;
      color: var(--text-muted);
      border: 1px solid var(--border-medium);
      border-radius: 12px;
      padding: 2px 10px;
      white-space: nowrap;
      transition: color 0.15s ease, border-color 0.15s ease;
      cursor: default;
    }
    .detail-pill:hover {
      color: var(--accent-gold);
      border-color: var(--accent-gold-border);
    }

    .btn-continue-compact {
      flex-shrink: 0; width: 100%; padding: 7px 16px; border: none; border-radius: var(--radius-sm);
      background: var(--accent-gold); color: var(--bg-primary);
      font-family: var(--font-sans); font-size: 13px; font-weight: 600;
      cursor: pointer; transition: background 0.15s ease, box-shadow 0.2s ease;
      letter-spacing: 0.01em; white-space: nowrap;
    }
    .btn-continue-compact:hover { background: var(--accent-gold-hover); box-shadow: 0 0 16px var(--accent-gold-glow); }
    .btn-continue-compact:disabled { opacity: 0.3; cursor: default; box-shadow: none; }
    .btn-continue-compact:disabled:hover { background: var(--accent-gold); box-shadow: none; }

    /* === BACK BUTTON (with text) ===
       Matches Attuning's back-btn pattern: icon + text, muted, gold on hover.
    */
    .back-btn {
      display: flex; align-items: center; gap: 6px;
      background: none; border: none;
      color: var(--text-muted); font-family: var(--font-sans);
      font-size: 13px; cursor: pointer; padding: 4px 0;
      transition: color 0.15s ease;
    }
    .back-btn:hover { color: var(--accent-gold); }

    .streaming-cursor::after {
      content: '\25CB'; color: var(--accent-gold);
      animation: cursor-blink 1s step-end infinite; margin-left: 1px; font-size: 12px;
    }
    @keyframes cursor-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
    }
  </style>
</head>
<body>

  <div class="app-shell">

    <header class="app-header">
      <button class="app-header-home" aria-label="Return to home">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
      </button>
      <span class="app-header-title">Calamity in the Witherwild</span>
    </header>

    <div class="app-layout">

    <!-- ================================================================
         CHAT SIDE (65%)
         ================================================================ -->
    <div class="chat-side">
      <div class="message-area">
        <div class="messages">

          <!-- Sage: Opening — introduces frame selection -->
          <div class="message message-sage">
            <div class="sage-label">Sage</div>
            <div class="message-text">
              <p>Your components are tuned and humming. Now we bind the spell to a foundation — a <strong>frame</strong> that anchors your adventure's world, factions, core conflict, and inciting incident.</p>
              <p>I've pulled the frames from the archive. Take a look at the panel — each card is a world waiting to be explored. Click one to see its full story.</p>
            </div>
          </div>

          <!-- User: Interest in Witherwild -->
          <div class="message message-user">
            <div class="message-text">
              The Witherwild sounds interesting. Tell me more about it.
            </div>
          </div>

          <!-- Sage: Witherwild details -->
          <div class="message message-sage">
            <div class="sage-label">Sage</div>
            <div class="message-text">
              <p>The Witherwild is a story of consequences. The nation of Haven invaded the forest realm of Fanewick and stole the Reaping Eye from Nikta, the Great Owl — and in doing so, triggered an endless spring. What sounds idyllic became catastrophic: unchecked growth devouring everything in its path.</p>
              <p>You've got three factions pulling in different directions: the <strong>Wicklings</strong>, hardy forest folk following ancient rules; the <strong>Havenites</strong>, desperate survivors of plague who drove themselves to invasion; and <strong>the Witherwild itself</strong> — nature run amok, neither good nor evil, just relentless.</p>
              <p>With your balanced tone and discovery-led pillars, this frame gives you moral complexity without grimdark — every faction thinks they're right. Your players will have to decide who to help, and what they're willing to sacrifice.</p>
            </div>
          </div>

          <!-- User: Wants to select -->
          <div class="message message-user">
            <div class="message-text">
              That's exactly the kind of tension I want. I'm going with the Witherwild.
            </div>
          </div>

          <!-- Sage: Confirms frame selection -->
          <div class="message message-sage">
            <div class="sage-label">Sage</div>
            <div class="message-text">
              <p>The Witherwild it is. Your adventure is bound to a world of unchecked growth, desperate factions, and moral complexity — with an inciting incident that drops your party right into the heart of the conflict.</p>
              <p>When you're ready, we'll move on to <strong>Weaving</strong> — where we draft the scene-by-scene arc of your story.</p>
            </div>
          </div>

        </div>
      </div>

      <div class="input-area">
        <div class="input-container">
          <textarea class="chat-input" placeholder="What path shall we take?" rows="3"></textarea>
          <button class="submit-btn" aria-label="Send message">
            <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">
              <polygon points="12,2 16,12 12,22 8,12"></polygon>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- ================================================================
         PANEL SIDE (35%) — Frame Gallery + Detail Panel
         ================================================================ -->
    <div class="panel-side">

      <div class="panel-header">
        <div class="app-header-phase" onclick="togglePhaseDropdown()" role="button" tabindex="0" aria-expanded="false" aria-haspopup="true">
          <span class="phase-name">Binding</span>
          <span class="phase-progress">Which frame holds the story?</span>
          <span class="phase-chevron" id="phase-chevron">&#x25BE;</span>

          <div class="phase-dropdown" id="phase-dropdown" role="menu">
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Invoking</span><span class="phase-item-desc">What shape will your adventure take?</span></div>
            </div>
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Attuning</span><span class="phase-item-desc">How should it feel?</span></div>
            </div>
            <div class="phase-dropdown-item current" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Binding</span><span class="phase-item-desc">Which frame holds the story?</span></div>
            </div>
            <div class="phase-dropdown-item future" role="menuitem" tabindex="-1">
              <div class="phase-item-text"><span>Weaving</span><span class="phase-item-desc">How does the plot unfold?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span>
            </div>
            <div class="phase-dropdown-item future" role="menuitem" tabindex="-1">
              <div class="phase-item-text"><span>Inscribing</span><span class="phase-item-desc">What unfolds in each scene?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span>
            </div>
            <div class="phase-dropdown-item future" role="menuitem" tabindex="-1">
              <div class="phase-item-text"><span>Conjuring</span><span class="phase-item-desc">Who will the party meet?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span>
            </div>
            <div class="phase-dropdown-item future" role="menuitem" tabindex="-1">
              <div class="phase-item-text"><span>Summoning</span><span class="phase-item-desc">What stands in their way?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span>
            </div>
            <div class="phase-dropdown-item future" role="menuitem" tabindex="-1">
              <div class="phase-item-text"><span>Enchanting</span><span class="phase-item-desc">What treasures await?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span>
            </div>
            <div class="phase-dropdown-item future" role="menuitem" tabindex="-1">
              <div class="phase-item-text"><span>Delivering</span><span class="phase-item-desc">Your tale awaits</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Frame Gallery — scrollable (default view) -->
      <div class="frame-list" id="frame-gallery">
        <div class="frame-scroll">

          <!-- The Witherwild — ACTIVE (frame confirmed) -->
          <div class="frame-card active" data-frame="witherwild" onclick="clickFrame(this)">
            <div class="frame-card-name">The Witherwild</div>
            <div class="frame-card-pitch">A Wickling elder sends a desperate plea — the overgrowth has breached the village walls, and something ancient stirs in the deep forest. The party is the last group willing to answer.</div>
          </div>

          <!-- The Shattered Bastion — unselected -->
          <div class="frame-card" data-frame="bastion" onclick="clickFrame(this)">
            <div class="frame-card-name">The Shattered Bastion</div>
            <div class="frame-card-pitch">A disgraced knight arrives at the party's door carrying a stolen fragment of the Divine Compact — and the three founding orders are already hunting her. She has hours before they find her, and the fragment is cracking.</div>
          </div>

          <!-- The Drowned Court — unselected -->
          <div class="frame-card" data-frame="drowned" onclick="clickFrame(this)">
            <div class="frame-card-name">The Drowned Court</div>
            <div class="frame-card-pitch">Fishing boats have been vanishing near the coast, and last night the sea pulled back to reveal black spires rising from the sand. A waterlogged herald staggers ashore bearing a centuries-old writ — summoning the party to court by name.</div>
          </div>

        </div>

        <!-- Fixed footer — always visible at bottom of gallery -->
        <div class="gallery-footer">
          <button class="btn-continue-compact" id="btn-continue">Continue to Weaving</button>
        </div>

      </div>

      <!--
        FRAME DETAIL PANEL — shows when a frame is clicked.
        Top: Collapsible frame detail sections (11 sections, 5 expanded by default).
        Bottom: Fixed "Select Frame" button that never scrolls away.

        MOCKUP NOTE: Detail section content is static (Witherwild only).
        In production, clicking any frame populates all sections dynamically
        from the database row. The same collapsible structure applies to all frames.

        Two exit paths:
          "Back to Frames" link — returns to gallery, no frame active
          "Select Frame" button — returns to gallery, frame marked active
      -->
      <div class="detail-panel" id="detail-panel">
        <!-- Fixed header -->
        <div class="detail-panel-header">
          <button class="back-btn" onclick="backToGallery()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Back to Frames
          </button>
          <div class="detail-frame-name" id="detail-frame-name">The Witherwild</div>
          <div class="detail-frame-pitch" id="detail-frame-pitch">A stolen relic triggers endless spring — three factions clash as nature devours everything in its path.</div>
        </div>

        <!-- Scrollable content: detail sections -->
        <div class="detail-content">

          <!-- ===== EXPANDED BY DEFAULT ===== -->

          <div class="detail-section expanded" data-section="overview">
            <div class="detail-section-header" onclick="toggleSection(this)">
              <span class="detail-section-chevron">&#x25B8;</span>
              <span class="detail-section-label">Overview</span>
            </div>
            <div class="detail-section-body">
              The nation of Haven, ravaged by plague, invaded the forest realm of Fanewick and stole the Reaping Eye from Nikta, the Great Owl. This triggered an endless spring — unchecked growth devouring everything in its path. Three factions now clash: the <strong>Wicklings</strong>, hardy forest folk following ancient rules; the <strong>Havenites</strong>, desperate survivors driven to invasion by plague; and <strong>the Witherwild itself</strong> — nature run amok, neither good nor evil, just relentless.
            </div>
          </div>

          <div class="detail-section expanded" data-section="inciting-incident">
            <div class="detail-section-header" onclick="toggleSection(this)">
              <span class="detail-section-chevron">&#x25B8;</span>
              <span class="detail-section-label">Inciting Incident</span>
            </div>
            <div class="detail-section-body">
              A Wickling elder sends a desperate plea — the overgrowth has breached the village walls, and something ancient stirs in the deep forest. The party is the last group willing to answer.
            </div>
          </div>

          <!-- ===== COLLAPSED BY DEFAULT ===== -->

          <div class="detail-section" data-section="tone-feel">
            <div class="detail-section-header" onclick="toggleSection(this)">
              <span class="detail-section-chevron">&#x25B8;</span>
              <span class="detail-section-label">Tone &amp; Feel</span>
            </div>
            <div class="detail-section-body">
              <div class="detail-pills">
                <span class="detail-pill">Morally Complex</span>
                <span class="detail-pill">Urgent</span>
                <span class="detail-pill">Bittersweet</span>
              </div>
            </div>
          </div>

          <div class="detail-section" data-section="touchstones">
            <div class="detail-section-header" onclick="toggleSection(this)">
              <span class="detail-section-chevron">&#x25B8;</span>
              <span class="detail-section-label">Touchstones</span>
            </div>
            <div class="detail-section-body">
              <div class="detail-pills">
                <span class="detail-pill">Princess Mononoke</span>
                <span class="detail-pill">The Last of Us</span>
                <span class="detail-pill">Annihilation</span>
              </div>
            </div>
          </div>

          <div class="detail-section" data-section="themes">
            <div class="detail-section-header" onclick="toggleSection(this)">
              <span class="detail-section-chevron">&#x25B8;</span>
              <span class="detail-section-label">Themes</span>
            </div>
            <div class="detail-section-body">
              <div class="detail-pills">
                <span class="detail-pill">Cultural Clash</span>
                <span class="detail-pill">Grief</span>
                <span class="detail-pill">Survival</span>
                <span class="detail-pill">People vs. Nature</span>
                <span class="detail-pill">Transformation</span>
              </div>
            </div>
          </div>

          <div class="detail-section" data-section="distinctions">
            <div class="detail-section-header" onclick="toggleSection(this)">
              <span class="detail-section-chevron">&#x25B8;</span>
              <span class="detail-section-label">Distinctions</span>
            </div>
            <div class="detail-section-body">
              Three factions with legitimate grievances — no clear villain. The Witherwild itself is neither good nor evil, just relentless. The conflict was caused by desperation, not malice. Every faction thinks they're right; your players will have to decide who to help.
            </div>
          </div>

          <div class="detail-section" data-section="heritage-classes">
            <div class="detail-section-header" onclick="toggleSection(this)">
              <span class="detail-section-chevron">&#x25B8;</span>
              <span class="detail-section-label">Heritage &amp; Classes Guidance</span>
            </div>
            <div class="detail-section-body">
              Wicklings favor Druids and Rangers — those attuned to the forest's rhythms. Havenites lean toward Fighters and Clerics, shaped by military discipline and faith. The Wild calls to Warlocks and those with nature-touched ancestries like Fungril or Fauns.
            </div>
          </div>

          <div class="detail-section" data-section="principles">
            <div class="detail-section-header" onclick="toggleSection(this)">
              <span class="detail-section-chevron">&#x25B8;</span>
              <span class="detail-section-label">Player &amp; GM Principles</span>
            </div>
            <div class="detail-section-body">
              <strong>Players:</strong> Listen to the forest. Every faction believes they are right. Your choices shape who survives.<br><br>
              <strong>GM:</strong> The Witherwild is a character, not a backdrop. Escalate the overgrowth steadily. Let factions react to the party's choices, not a predetermined script.
            </div>
          </div>

          <div class="detail-section" data-section="custom-mechanics">
            <div class="detail-section-header" onclick="toggleSection(this)">
              <span class="detail-section-chevron">&#x25B8;</span>
              <span class="detail-section-label">Custom Mechanics</span>
            </div>
            <div class="detail-section-body">
              <strong>Overgrowth Clock:</strong> A 6-segment clock that advances when the party delays or the wild senses conflict. At full, a Witherwild surge overtakes the current location, transforming the environment and forcing immediate action.
            </div>
          </div>

          <div class="detail-section" data-section="session-zero">
            <div class="detail-section-header" onclick="toggleSection(this)">
              <span class="detail-section-chevron">&#x25B8;</span>
              <span class="detail-section-label">Session Zero Questions</span>
            </div>
            <div class="detail-section-body">
              <ul style="padding-left: 16px; margin: 0; list-style: disc;">
                <li>How does your character feel about nature's unchecked power?</li>
                <li>Which faction's cause resonates most with your backstory?</li>
                <li>What would your character sacrifice to end the overgrowth?</li>
              </ul>
            </div>
          </div>

          <div class="detail-section" data-section="complexity">
            <div class="detail-section-header" onclick="toggleSection(this)">
              <span class="detail-section-chevron">&#x25B8;</span>
              <span class="detail-section-label">Complexity Rating</span>
            </div>
            <div class="detail-section-body">
              <strong>3 / 5</strong> — Multiple factions and moral ambiguity add planning complexity, but the core conflict is straightforward.
            </div>
          </div>

        </div><!-- /detail-content -->

        <!-- Fixed footer — always visible at bottom -->
        <div class="detail-panel-footer">
          <button class="btn-select-frame" onclick="selectFrameAndReturn()">Select Frame</button>
        </div>

      </div><!-- /detail-panel -->

    </div>

    </div><!-- /app-layout -->
  </div><!-- /app-shell -->

  <script>
    // Track state
    let exploringFrame = null;
    let activeFrame = null;

    // Initialize: Witherwild is pre-selected (mockup snapshot)
    activeFrame = document.querySelector('.frame-card[data-frame="witherwild"]');

    function toggleSection(header) {
      const section = header.closest('.detail-section');
      section.classList.toggle('expanded');
    }

    function clickFrame(card) {
      const gallery = document.getElementById('frame-gallery');
      const panel = document.getElementById('detail-panel');

      // Clear any previous exploring state
      document.querySelectorAll('.frame-card.exploring').forEach(c => c.classList.remove('exploring'));

      // If clicking a new (non-active) frame, add exploring state
      if (!card.classList.contains('active')) {
        card.classList.add('exploring');
      }

      exploringFrame = card;

      // Update detail panel header with frame name and pitch
      const displayName = card.querySelector('.frame-card-name').textContent;
      const displayPitch = card.querySelector('.frame-card-pitch').textContent;
      document.getElementById('detail-frame-name').textContent = displayName;
      document.getElementById('detail-frame-pitch').textContent = displayPitch;

      // Reset scroll to top so user sees detail first
      const detailContent = panel.querySelector('.detail-content');
      if (detailContent) detailContent.scrollTop = 0;

      // Cross-fade: gallery out, detail panel in
      gallery.classList.add('hidden');
      panel.classList.add('visible');
    }

    function backToGallery() {
      const gallery = document.getElementById('frame-gallery');
      const panel = document.getElementById('detail-panel');

      // Back without selecting — clear exploring state, no frame becomes active
      if (exploringFrame) {
        exploringFrame.classList.remove('exploring');
      }

      exploringFrame = null;

      // Cross-fade: detail panel out, gallery in
      panel.classList.remove('visible');
      gallery.classList.remove('hidden');
    }

    function selectFrameAndReturn() {
      const gallery = document.getElementById('frame-gallery');
      const panel = document.getElementById('detail-panel');

      if (!exploringFrame) return;

      // Clear any previous active frame
      document.querySelectorAll('.frame-card').forEach(c => {
        c.classList.remove('active');
        c.classList.remove('exploring');
      });

      // Mark this frame as active (confirmed)
      exploringFrame.classList.add('active');
      activeFrame = exploringFrame;
      exploringFrame = null;

      // Enable continue button
      document.getElementById('btn-continue').disabled = false;

      // Cross-fade: detail panel out, gallery in
      panel.classList.remove('visible');
      gallery.classList.remove('hidden');
    }

    function togglePhaseDropdown() {
      const dropdown = document.getElementById('phase-dropdown');
      const chevron = document.getElementById('phase-chevron');
      const trigger = document.querySelector('.app-header-phase');
      const isOpen = dropdown.classList.contains('open');
      if (isOpen) {
        dropdown.classList.remove('open'); chevron.classList.remove('open');
        trigger.setAttribute('aria-expanded', 'false');
      } else {
        dropdown.classList.add('open'); chevron.classList.add('open');
        trigger.setAttribute('aria-expanded', 'true');
      }
    }

    document.addEventListener('click', function(e) {
      const trigger = document.querySelector('.app-header-phase');
      const dropdown = document.getElementById('phase-dropdown');
      if (!trigger.contains(e.target)) {
        dropdown.classList.remove('open');
        document.getElementById('phase-chevron').classList.remove('open');
        trigger.setAttribute('aria-expanded', 'false');
      }
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        const dropdown = document.getElementById('phase-dropdown');
        if (dropdown.classList.contains('open')) {
          dropdown.classList.remove('open');
          document.getElementById('phase-chevron').classList.remove('open');
          document.querySelector('.app-header-phase').setAttribute('aria-expanded', 'false');
        }
      }
    });

    const textarea = document.querySelector('.chat-input');
    textarea.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 180) + 'px';
    });

    document.querySelector('.message-area').scrollTop = document.querySelector('.message-area').scrollHeight;
  </script>

</body>
</html>
