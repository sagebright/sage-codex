<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dagger-App — Conjuring (Immersive Mockup)</title>

  <!--
    ==========================================================================
    STAGE 6: CONJURING — Who will the party meet?
    ==========================================================================
    Panel pattern: NPC ROSTER
    Sage compiles NPCs from the inscribed scenes, presents them in a roster
    grouped as Key NPCs and Minor NPCs. The user can request enrichment
    (backstory, voice, motivation, secret) for any NPC. Enrichment is optional;
    the user can continue to Summoning at any time.

    DESIGN RATIONALE: NPC cards are compact rows — avatar initials, name, role,
    scene badges, and enrichment status. The enriched/basic distinction uses the
    same gold left-border pattern as confirmed components and selected frames,
    maintaining visual continuity across stages. Enriched NPCs have a gold
    avatar border and check mark; basic NPCs have muted styling and a dash.
    ==========================================================================
  -->

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Source+Serif+4:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">

  <style>
    /* =======================================================================
       DESIGN TOKENS — Shared across all mockups
       ======================================================================= */
    :root {
      --bg-primary: #1c1b1f;
      --bg-secondary: #252428;
      --bg-surface: #2e2d32;
      --bg-surface-hover: #353439;
      --text-primary: #e8e4de;
      --text-secondary: #9d9a93;
      --text-muted: #6b6862;
      --accent-gold: #d7a964;
      --accent-gold-hover: #e5bc7a;
      --accent-gold-dim: rgba(215, 169, 100, 0.12);
      --accent-gold-border: rgba(215, 169, 100, 0.25);
      --accent-gold-glow: rgba(215, 169, 100, 0.15);
      --border-subtle: rgba(255, 255, 255, 0.06);
      --border-medium: rgba(255, 255, 255, 0.10);
      --border-hover: rgba(255, 255, 255, 0.14);
      --user-msg-bg: rgba(255, 255, 255, 0.07);
      --font-serif: 'Source Serif 4', Georgia, 'Times New Roman', serif;
      --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
      --message-gap: 28px;
      --section-padding: 24px;
      --panel-padding: 20px;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
    }

    /* === RESET & BASE === */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%; overflow: hidden;
      background: var(--bg-primary); color: var(--text-primary);
      font-family: var(--font-sans); font-size: 15px; line-height: 1.6;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }

    /* === LAYOUT === */
    .app-shell { display: flex; flex-direction: column; height: 100vh; width: 100%; }
    .app-header {
      flex-shrink: 0; display: flex; align-items: center;
      padding: 0 16px; height: 56px;
      background: var(--bg-secondary); border-bottom: 1px solid var(--border-subtle);
    }
    .app-header-home {
      display: flex; align-items: center; justify-content: center;
      width: 32px; height: 32px; border-radius: var(--radius-sm);
      background: none; border: none; color: var(--text-muted);
      cursor: pointer; transition: color 0.15s ease, background 0.15s ease; flex-shrink: 0;
    }
    .app-header-home:hover { color: var(--text-secondary); background: var(--bg-surface); }
    .app-header-title {
      font-family: var(--font-serif); font-size: 16px; font-weight: 500;
      color: var(--accent-gold); white-space: nowrap; overflow: hidden;
      text-overflow: ellipsis; min-width: 0; flex: 1; text-align: center;
    }
    .app-layout { display: grid; grid-template-columns: 13fr 7fr; flex: 1; min-height: 0; width: 100%; }

    /* === CHAT SIDE === */
    .chat-side { display: flex; flex-direction: column; min-height: 0; border-right: 1px solid var(--border-subtle); }
    .message-area {
      flex: 1; overflow-y: auto; padding: 36px var(--section-padding) 8px;
      scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.08) transparent;
    }
    .message-area::-webkit-scrollbar { width: 6px; }
    .message-area::-webkit-scrollbar-track { background: transparent; }
    .message-area::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }
    .messages { max-width: 720px; margin: 0 auto; display: flex; flex-direction: column; gap: var(--message-gap); }
    .message { max-width: 88%; animation: message-appear 0.4s ease-out both; }
    @keyframes message-appear {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .message-sage { align-self: flex-start; }
    .message-sage .message-text { font-family: var(--font-serif); font-size: 16px; }
    .message-user {
      align-self: flex-end; background: var(--user-msg-bg);
      border: 1px solid var(--border-subtle); padding: 12px 16px; border-radius: var(--radius-md);
    }
    .sage-label {
      font-family: var(--font-serif); font-size: 12px; font-weight: 500;
      color: var(--text-muted); letter-spacing: 0.03em; margin-bottom: 6px;
    }
    .message-text { color: var(--text-primary); line-height: 1.65; }
    .message-text p + p { margin-top: 12px; }
    .message:nth-child(1) { animation-delay: 0s; }
    .message:nth-child(2) { animation-delay: 0.06s; }
    .message:nth-child(3) { animation-delay: 0.12s; }
    .message:nth-child(4) { animation-delay: 0.18s; }
    .message:nth-child(5) { animation-delay: 0.24s; }
    .message:nth-child(6) { animation-delay: 0.30s; }
    .message:nth-child(7) { animation-delay: 0.36s; }
    .message:nth-child(8) { animation-delay: 0.42s; }
    .thinking-indicator { display: flex; align-items: center; gap: 5px; padding: 4px 0; align-self: flex-start; }
    .thinking-indicator .sage-label { margin-bottom: 0; margin-right: 4px; }
    .thinking-dot {
      width: 5px; height: 5px; border-radius: 50%;
      background: var(--accent-gold); opacity: 0.3;
      animation: thinking-pulse 1.4s ease-in-out infinite;
    }
    .thinking-dot:nth-child(2) { animation-delay: 0.2s; }
    .thinking-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes thinking-pulse {
      0%, 80%, 100% { opacity: 0.2; transform: scale(0.85); }
      40% { opacity: 0.9; transform: scale(1); }
    }

    /* === INPUT === */
    .input-area { flex-shrink: 0; padding: 12px var(--section-padding) var(--section-padding); }
    .input-container { position: relative; max-width: 720px; margin: 0 auto; }
    .chat-input {
      width: 100%; min-height: 88px; max-height: 180px;
      padding: 14px 52px 14px 18px; background: var(--bg-secondary);
      border: 1px solid var(--border-subtle); border-radius: var(--radius-lg);
      color: var(--text-primary); font-family: var(--font-sans);
      font-size: 15px; line-height: 1.55; resize: none; outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .chat-input::placeholder { color: var(--text-muted); font-style: italic; }
    .chat-input:focus { border-color: var(--accent-gold-border); box-shadow: 0 0 0 3px var(--accent-gold-glow); }
    .submit-btn {
      position: absolute; bottom: 12px; right: 12px; width: 36px; height: 36px;
      border-radius: 50%; border: none; background: var(--accent-gold);
      color: var(--bg-primary); cursor: pointer; display: flex; align-items: center;
      justify-content: center; transition: background 0.15s ease, transform 0.15s ease; opacity: 0.7;
    }
    .submit-btn:hover { background: var(--accent-gold-hover); opacity: 1; transform: scale(1.05); }
    .submit-btn svg { width: 20px; height: 20px; }

    /* === PANEL SIDE === */
    .panel-side {
      display: flex; flex-direction: column; min-height: 0; background: var(--bg-secondary);
    }
    .panel-header {
      flex-shrink: 0; padding: 12px var(--panel-padding) 4px;
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
    }

    /* Phase dropdown trigger + dropdown */
    .app-header-phase {
      position: relative; display: flex; align-items: center; gap: 8px;
      cursor: pointer; padding: 4px 10px 4px 4px; border-radius: var(--radius-sm);
      border: none; background: none; transition: background 0.15s ease; flex-shrink: 0;
    }
    .app-header-phase:hover { background: var(--bg-surface); }
    .phase-name { font-family: var(--font-sans); font-size: 13px; font-weight: 500; color: var(--accent-gold); }
    .phase-progress { font-family: var(--font-sans); font-size: 12px; color: var(--text-muted); }
    .phase-chevron { color: var(--text-muted); font-size: 10px; transition: transform 0.2s ease; margin-left: -2px; }
    .phase-chevron.open { transform: rotate(180deg); }
    .phase-dropdown {
      position: absolute; top: calc(100% + 6px); left: 50%; transform: translateX(-50%);
      min-width: 260px; background: var(--bg-surface); border: 1px solid var(--border-medium);
      border-radius: var(--radius-md); box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      padding: 6px; z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.15s ease;
    }
    .phase-dropdown.open { opacity: 1; pointer-events: auto; }
    .phase-dropdown-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 12px; border-radius: var(--radius-sm); font-family: var(--font-sans);
      font-size: 13px; color: var(--text-secondary); cursor: pointer;
      transition: background 0.12s ease; border: none; background: none; width: 100%; text-align: left;
    }
    .phase-dropdown-item:hover { background: var(--bg-surface-hover); }
    .phase-dropdown-item.current { color: var(--accent-gold); font-weight: 600; background: var(--accent-gold-dim); }
    .phase-dropdown-item.completed { color: var(--text-secondary); }
    .phase-dropdown-item.future { color: var(--text-muted); cursor: default; opacity: 0.6; }
    .phase-dropdown-item.future:hover { background: none; }
    .phase-item-icon { display: flex; align-items: center; flex-shrink: 0; margin-left: auto; padding-left: 12px; }
    .phase-item-icon svg { width: 12px; height: 12px; }
    .phase-item-text { display: flex; flex-direction: column; gap: 1px; min-width: 0; }
    .phase-item-desc { font-size: 11px; font-weight: 400; color: var(--text-muted); }
    .phase-dropdown-item.current .phase-item-desc { color: var(--accent-gold); opacity: 0.7; }

    /* === SCENE SELECTOR (shared pattern) === */
    .scene-selector {
      display: flex; flex-direction: row; gap: 6px;
      padding: 0 var(--panel-padding); margin-bottom: 12px;
    }
    .scene-selector-tab {
      min-width: 48px; padding: 6px 12px; border-radius: var(--radius-sm);
      font-family: var(--font-sans); font-size: 13px; cursor: pointer;
      text-align: center; border: none; transition: background 0.15s ease, color 0.15s ease;
    }
    .scene-selector-tab.active {
      background: var(--accent-gold); color: var(--bg-primary); font-weight: 600;
    }
    .scene-selector-tab:not(.active) {
      background: var(--bg-surface); color: var(--text-secondary);
    }
    .scene-selector-tab:not(.active):hover {
      background: var(--bg-surface-hover); color: var(--text-primary);
    }

    /* === NPC ROSTER (Conjuring-specific) ===
       DESIGN RATIONALE: NPC cards are compact horizontal rows similar to
       component rows in Attuning. The enriched/basic distinction uses the
       same gold left-border treatment as confirmed components and selected
       frames — visual continuity across stages. Avatar initials provide a
       quick visual anchor; role pills mirror frame theme pills for consistency.
       Scene badges show which scenes each NPC appears in at a glance.
    */
    .npc-list {
      flex: 1; overflow-y: auto; padding: 8px var(--panel-padding);
      scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.06) transparent;
    }
    .npc-list::-webkit-scrollbar { width: 5px; }
    .npc-list::-webkit-scrollbar-track { background: transparent; }
    .npc-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 3px; }

    /* ---- NPC Groups ---- */
    .npc-group {
      margin-top: 20px;
    }
    .npc-group:first-child {
      margin-top: 12px;
    }
    .npc-group-label {
      font-family: var(--font-serif);
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 6px;
      padding-left: 4px;
    }

    /* ---- NPC Cards ---- */
    .npc-card {
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: 12px;
      gap: 12px;
      border-left: 3px solid transparent;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: background 0.15s ease, border-left-color 0.15s ease;
    }
    .npc-card:hover {
      background: var(--bg-surface);
    }
    .npc-card.enriched {
      border-left-color: var(--accent-gold);
    }

    /* ---- NPC Avatar ---- */
    .npc-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--bg-surface);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-serif);
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      border: 1.5px solid var(--border-medium);
    }
    .npc-avatar.enriched {
      border: 1.5px solid var(--accent-gold);
      color: var(--accent-gold);
    }

    /* ---- NPC Info ---- */
    .npc-info {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 0;
      gap: 4px;
    }
    .npc-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.3;
    }
    .npc-role-tag {
      display: inline-block;
      font-size: 11px;
      font-weight: 500;
      color: var(--text-muted);
      border: 1px solid var(--border-medium);
      border-radius: 12px;
      padding: 1px 8px;
      white-space: nowrap;
      width: fit-content;
    }

    /* ---- NPC Meta (right side) ---- */
    .npc-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      flex-shrink: 0;
    }
    .scene-badges {
      display: flex;
      flex-direction: row;
      gap: 4px;
    }
    .scene-badge {
      display: inline-block;
      font-family: var(--font-sans);
      font-size: 11px;
      font-weight: 500;
      color: var(--text-muted);
      background: var(--bg-surface);
      border: 1px solid var(--border-medium);
      padding: 1px 10px;
      border-radius: 12px;
      white-space: nowrap;
      line-height: 1.4;
    }
    .npc-enrichment {
      font-size: 13px;
      line-height: 1;
    }
    .npc-enrichment.enriched {
      color: var(--accent-gold);
    }
    .npc-enrichment.basic {
      color: var(--text-muted);
    }

    .btn-continue-compact {
      flex-shrink: 0; padding: 7px 16px; border: none; border-radius: var(--radius-sm);
      background: var(--accent-gold); color: var(--bg-primary);
      font-family: var(--font-sans); font-size: 13px; font-weight: 600;
      cursor: pointer; transition: background 0.15s ease, box-shadow 0.2s ease;
      letter-spacing: 0.01em; white-space: nowrap;
    }
    .btn-continue-compact:hover { background: var(--accent-gold-hover); box-shadow: 0 0 16px var(--accent-gold-glow); }
    .btn-continue-compact:disabled { opacity: 0.3; cursor: default; box-shadow: none; }
    .btn-continue-compact:disabled:hover { background: var(--accent-gold); box-shadow: none; }

    .streaming-cursor::after {
      content: '\25CB'; color: var(--accent-gold);
      animation: cursor-blink 1s step-end infinite; margin-left: 1px; font-size: 12px;
    }
    @keyframes cursor-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
    }
  </style>
</head>
<body>

  <div class="app-shell">

    <header class="app-header">
      <button class="app-header-home" aria-label="Return to home">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
      </button>
      <span class="app-header-title">Calamity in the Witherwild</span>
    </header>

    <div class="app-layout">

    <!-- ================================================================
         CHAT SIDE (60%)
         ================================================================ -->
    <div class="chat-side">
      <div class="message-area">
        <div class="messages">

          <!-- Sage: Opening — compiles NPC roster -->
          <div class="message message-sage">
            <div class="sage-label">Sage</div>
            <div class="message-text">
              <p>The scenes are inscribed. Now we call the characters into being — every face, voice, and motive that your players will encounter across the four scenes.</p>
              <p>I've combed through each scene and compiled the roster you see on the panel. <strong>Three key NPCs</strong> drive the story, and <strong>two minor NPCs</strong> fill out the world. Each one is linked to the scenes where they appear.</p>
              <p>You can ask me to <strong>enrich</strong> any NPC — I'll flesh out their voice, motivation, and a hidden secret the GM can deploy. Or, if you're satisfied with the roster as-is, we can move straight to Summoning.</p>
            </div>
          </div>

          <!-- User: Asks to enrich Elder Thornweave -->
          <div class="message message-user">
            <div class="message-text">
              Tell me more about Elder Thornweave. What drives them? What are they hiding?
            </div>
          </div>

          <!-- Sage: Enriches Elder Thornweave -->
          <div class="message message-sage">
            <div class="sage-label">Sage</div>
            <div class="message-text">
              <p>Elder Thornweave is the last of the Wickling root-speakers — those who could hear the forest's will through the mycorrhizal network beneath the soil. When Haven's army cut through Fanewick, that connection went silent. Thornweave has been faking it ever since.</p>
              <p><strong>Voice:</strong> Measured and deliberate, like someone choosing each word the way you'd choose a step on a rotting bridge. Addresses everyone as "seedling" regardless of age or station.</p>
              <p><strong>Motivation:</strong> Restore the Wickling people's faith — even if the forest never speaks again. Will sacrifice personal honor to maintain the illusion of divine communion.</p>
              <p><strong>Secret:</strong> Thornweave knows the Reaping Eye wasn't just stolen — it was <em>given</em>. The Great Owl Nikta let Haven take it as a test, and Thornweave is the only one who witnessed the exchange. Revealing this would shatter the Wicklings' righteous anger and their reason to fight.</p>
              <p>I've marked Thornweave as enriched on the roster. Want me to do the same for Sergeant Kael or anyone else?</p>
            </div>
          </div>

          <!-- User: Enriches Sergeant Kael -->
          <div class="message message-user">
            <div class="message-text">
              Yes, enrich Sergeant Kael too. I want the antagonist to feel sympathetic.
            </div>
          </div>

          <!-- Sage: Enriches Sergeant Kael -->
          <div class="message message-sage">
            <div class="sage-label">Sage</div>
            <div class="message-text">
              <p>Sergeant Kael was a field medic before the Havenite command gave her a sword and a squad. She didn't choose this war — she chose to keep her people alive when plague was eating Haven from the inside out. The invasion was supposed to be quick: take the Eye, heal the plague, go home. That was three years ago.</p>
              <p><strong>Voice:</strong> Clipped and efficient, but softens when talking about the soldiers under her command. Calls the party "civilians" even if they're clearly armed. Fidgets with a locket she never opens.</p>
              <p><strong>Motivation:</strong> Get her surviving squad home alive. Has stopped believing the Eye will fix anything — now she's just trying to minimize casualties on both sides.</p>
              <p><strong>Secret:</strong> Kael has been secretly leaving supply caches for displaced Wickling families. If her commanding officer finds out, she'll be executed for treason. If the Wicklings find out, they might stop trying to kill her squad.</p>
              <p>Both key NPCs with direct conflict involvement are now enriched. The Hollow Voice is still basic — want to flesh them out, or are you ready to move on to Summoning?</p>
            </div>
          </div>

          <!-- User: Satisfied, ready to continue -->
          <div class="message message-user">
            <div class="message-text">
              That's great. I'll leave the rest basic for now — I can always come back. Let's move on.
            </div>
          </div>

          <!-- Sage: Confirms, offers transition -->
          <div class="message message-sage">
            <div class="sage-label">Sage</div>
            <div class="message-text">
              <p>Your cast is assembled — two enriched key NPCs with layered motivations, and three more waiting in the wings if you need them later. The roster is saved.</p>
              <p>When you're ready, hit <strong>Continue to Summoning</strong> on the panel. We'll call forth the threats and opposing forces that will challenge your party at the table.</p>
            </div>
          </div>

        </div>
      </div>

      <div class="input-area">
        <div class="input-container">
          <textarea class="chat-input" placeholder="Ask about any NPC, or continue..." rows="3"></textarea>
          <button class="submit-btn" aria-label="Send message">
            <svg viewBox="0 0 24 24" fill="currentColor" stroke="none">
              <polygon points="12,2 16,12 12,22 8,12"></polygon>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- ================================================================
         PANEL SIDE (40%) — NPC Roster
         ================================================================ -->
    <div class="panel-side">

      <div class="panel-header">
        <div class="app-header-phase" onclick="togglePhaseDropdown()" role="button" tabindex="0" aria-expanded="false" aria-haspopup="true">
          <span class="phase-name">Conjuring</span>
          <span class="phase-progress">Who will the party meet?</span>
          <span class="phase-chevron" id="phase-chevron">&#x25BE;</span>

          <div class="phase-dropdown" id="phase-dropdown" role="menu">
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Invoking</span><span class="phase-item-desc">What shape will your adventure take?</span></div>
            </div>
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Attuning</span><span class="phase-item-desc">How should it feel?</span></div>
            </div>
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Binding</span><span class="phase-item-desc">Which frame holds the story?</span></div>
            </div>
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Weaving</span><span class="phase-item-desc">How does the plot unfold?</span></div>
            </div>
            <div class="phase-dropdown-item completed" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Inscribing</span><span class="phase-item-desc">What unfolds in each scene?</span></div>
            </div>
            <div class="phase-dropdown-item current" role="menuitem" tabindex="0">
              <div class="phase-item-text"><span>Conjuring</span><span class="phase-item-desc">Who will the party meet?</span></div>
            </div>
            <div class="phase-dropdown-item future" role="menuitem" tabindex="-1">
              <div class="phase-item-text"><span>Summoning</span><span class="phase-item-desc">What stands in their way?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span>
            </div>
            <div class="phase-dropdown-item future" role="menuitem" tabindex="-1">
              <div class="phase-item-text"><span>Enchanting</span><span class="phase-item-desc">What treasures await?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span>
            </div>
            <div class="phase-dropdown-item future" role="menuitem" tabindex="-1">
              <div class="phase-item-text"><span>Scrying</span><span class="phase-item-desc">What might happen at the table?</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span>
            </div>
            <div class="phase-dropdown-item future" role="menuitem" tabindex="-1">
              <div class="phase-item-text"><span>Delivering</span><span class="phase-item-desc">Your tale awaits</span></div>
              <span class="phase-item-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Scene Selector -->
      <div class="scene-selector">
        <button class="scene-selector-tab" onclick="selectScene(this, -1)">All</button>
        <button class="scene-selector-tab active" onclick="selectScene(this, 0)">Scene 1</button>
        <button class="scene-selector-tab" onclick="selectScene(this, 1)">Scene 2</button>
        <button class="scene-selector-tab" onclick="selectScene(this, 2)">Scene 3</button>
        <button class="scene-selector-tab" onclick="selectScene(this, 3)">Scene 4</button>
      </div>

      <!-- NPC Roster — scrollable -->
      <div class="npc-list">

        <!-- Key NPCs -->
        <div class="npc-group">
          <div class="npc-group-label">Key NPCs</div>

          <!-- Elder Thornweave — Enriched -->
          <div class="npc-card enriched" onclick="selectNpc(this)">
            <div class="npc-avatar enriched">ET</div>
            <div class="npc-info">
              <div class="npc-name">Elder Thornweave</div>
              <span class="npc-role-tag">Leader</span>
            </div>
            <div class="npc-meta">
              <div class="scene-badges">
                <span class="scene-badge">Scene 2</span>
                <span class="scene-badge">Scene 4</span>
              </div>
              <span class="npc-enrichment enriched" title="Enriched">&#x2714;</span>
            </div>
          </div>

          <!-- Sergeant Kael — Enriched -->
          <div class="npc-card enriched" onclick="selectNpc(this)">
            <div class="npc-avatar enriched">SK</div>
            <div class="npc-info">
              <div class="npc-name">Sergeant Kael</div>
              <span class="npc-role-tag">Antagonist</span>
            </div>
            <div class="npc-meta">
              <div class="scene-badges">
                <span class="scene-badge">Scene 1</span>
                <span class="scene-badge">Scene 3</span>
              </div>
              <span class="npc-enrichment enriched" title="Enriched">&#x2714;</span>
            </div>
          </div>

          <!-- The Hollow Voice — Basic -->
          <div class="npc-card" onclick="selectNpc(this)">
            <div class="npc-avatar">HV</div>
            <div class="npc-info">
              <div class="npc-name">The Hollow Voice</div>
              <span class="npc-role-tag">Oracle</span>
            </div>
            <div class="npc-meta">
              <div class="scene-badges">
                <span class="scene-badge">Scene 4</span>
              </div>
              <span class="npc-enrichment basic" title="Basic">&mdash;</span>
            </div>
          </div>

        </div>

        <!-- Minor NPCs -->
        <div class="npc-group">
          <div class="npc-group-label">Minor NPCs</div>

          <!-- Moss — Basic -->
          <div class="npc-card" onclick="selectNpc(this)">
            <div class="npc-avatar">M</div>
            <div class="npc-info">
              <div class="npc-name">Moss</div>
              <span class="npc-role-tag">Scout</span>
            </div>
            <div class="npc-meta">
              <div class="scene-badges">
                <span class="scene-badge">Scene 2</span>
              </div>
              <span class="npc-enrichment basic" title="Basic">&mdash;</span>
            </div>
          </div>

          <!-- Quartermaster Dren — Basic -->
          <div class="npc-card" onclick="selectNpc(this)">
            <div class="npc-avatar">QD</div>
            <div class="npc-info">
              <div class="npc-name">Quartermaster Dren</div>
              <span class="npc-role-tag">Informant</span>
            </div>
            <div class="npc-meta">
              <div class="scene-badges">
                <span class="scene-badge">Scene 1</span>
              </div>
              <span class="npc-enrichment basic" title="Basic">&mdash;</span>
            </div>
          </div>

        </div>

        <!-- Continue button -->
        <button class="btn-continue-compact" style="margin: 24px auto 12px; display: block;">Continue to Summoning</button>

      </div>

    </div>

    </div><!-- /app-layout -->
  </div><!-- /app-shell -->

  <script>
    /* === Scene Selector === */
    function selectScene(tab, index) {
      document.querySelectorAll('.scene-selector-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      // In a real implementation, this would filter NPCs by scene association.
      // For the mockup, all NPCs are always shown.
    }

    function selectNpc(card) {
      // Visual feedback for clicking an NPC card (could open detail view in real app)
      document.querySelectorAll('.npc-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
    }

    function togglePhaseDropdown() {
      const dropdown = document.getElementById('phase-dropdown');
      const chevron = document.getElementById('phase-chevron');
      const trigger = document.querySelector('.app-header-phase');
      const isOpen = dropdown.classList.contains('open');
      if (isOpen) {
        dropdown.classList.remove('open'); chevron.classList.remove('open');
        trigger.setAttribute('aria-expanded', 'false');
      } else {
        dropdown.classList.add('open'); chevron.classList.add('open');
        trigger.setAttribute('aria-expanded', 'true');
      }
    }

    document.addEventListener('click', function(e) {
      const trigger = document.querySelector('.app-header-phase');
      const dropdown = document.getElementById('phase-dropdown');
      if (!trigger.contains(e.target)) {
        dropdown.classList.remove('open');
        document.getElementById('phase-chevron').classList.remove('open');
        trigger.setAttribute('aria-expanded', 'false');
      }
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        const dropdown = document.getElementById('phase-dropdown');
        if (dropdown.classList.contains('open')) {
          dropdown.classList.remove('open');
          document.getElementById('phase-chevron').classList.remove('open');
          document.querySelector('.app-header-phase').setAttribute('aria-expanded', 'false');
        }
      }
    });

    const textarea = document.querySelector('.chat-input');
    textarea.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 180) + 'px';
    });

    document.querySelector('.message-area').scrollTop = document.querySelector('.message-area').scrollHeight;
  </script>

</body>
</html>
